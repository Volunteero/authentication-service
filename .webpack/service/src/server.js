!function(e,r){for(var s in r)e[s]=r[s]}(exports,function(e){var r={};function s(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=r,s.d=function(e,r,o){s.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:o})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(r,"a",r),r},s.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},s.p="",s.w={},s(s.s=21)}([function(e,r,s){const o=s(1),n=o.Schema({username:{type:String,index:!0},password:String,loginAttempts:{type:Number,default:0},loginLockExpiry:Number});e.exports=o.model("User",n)},function(e,r){e.exports=require("mongoose")},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("dotenv")},function(e,r){e.exports=(e=>{e.use(function(e,r,s,o){return r.log.error({errorCode:`ServerError:${e.name}`,stack:e.stack}),s.status(500).json({serverError:!0})})})},function(e,r){e.exports=(e=>{e.use(function(e,r,s,o){"JsonSchemaValidation"===e.name?s.status(400).json({code:"BadParameterException",message:"There are some missing or invalid parameters in the reuqest",errors:e.validations}):o(e)})})},function(e,r){e.exports={type:"object",properties:{username:{type:"string",required:!0},password:{type:"string",required:!0,minLength:6,pattern:"^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})"}},additionalProperties:!1}},function(e,r){e.exports=require("express-jsonschema")},function(e,r,s){const o=s(0);e.exports.register=(async(e,r)=>{const{password:s,username:n}=e.body;if(null!==await o.findOne({username:n})){const s="UserExists";return e.log.info({errorCode:s,username:n}),r.status(409).json({errorCode:s,message:"Username exists"})}let t=new o({password:s,username:n});await t.save();r.status(201).json({success:!0})})},function(e,r){e.exports=require("util")},function(e,r){e.exports=require("jsonwebtoken")},function(e,r,s){s(3).config();const o=s(0),n=s(10),{isNumber:t}=s(9),i=process.env.PRIVATE_KEY;e.exports.login=(async(e,r)=>{const{password:s,username:t}=e.body,u=await o.findOne({username:t});if(null===u){const s="UserNotFound";return e.log.info({errorCode:s,username:t}),r.status(404).json({errorCode:s,message:"User not found"})}const{loginAttempts:a,loginLockExpiry:c}=u;let p=!1;if(c>Date.now()&&(p=!0),a>=5&&!p){const e=Date.now()+3e5;await u.update({loginAttempts:0,loginLockExpiry:e}),p=!0}if(p){const s="LoginAttemptsExceeded";return e.log.info({errorCode:s,username:t}),r.status(401).json({errorCode:s,message:"You have used a wrong password more than 5 times. Try again in a few minutes"})}const d=n.sign({username:t},Buffer.from(i,"base64"),{algorithm:"RS256",expiresIn:"10m"});return await u.update({loginAttempts:0}),r.cookie("accessToken",d,{signed:!0,secret:process.env.PRIVATE_KEY}),r.status(200).json({success:!0})})},function(e,r,s){const o=s(2),n=s(11),t=s(8),i=s(7).validate,u=s(6);e.exports=o.Router().post("/login",i({body:u}),n.login).post("/register",i({body:u}),t.register)},function(e,r,s){const o=s(12);e.exports=(e=>{e.use("/auth",o)})},function(e,r){e.exports=require("express-async-errors")},function(e,r){e.exports=require("express-pino-logger")},function(e,r){e.exports=require("express-sanitizer")},function(e,r){e.exports=require("cookie-parser")},function(e,r){e.exports=require("body-parser")},function(e,r,s){s(3).config();const o=s(2),n=s(18),t=s(17),i=s(16),u=s(1),a=s(15)();s(14),u.connect("mongodb://SePr-Group10:yKsst98NHg0vR9Bv@sepr-group10-shard-00-00-10se6.mongodb.net:27017,sepr-group10-shard-00-01-10se6.mongodb.net:27017,sepr-group10-shard-00-02-10se6.mongodb.net:27017/sepr?ssl=true&replicaSet=SePr-Group10-shard-0&authSource=admin");const c=s(13),p=s(5),d=s(4),f=o();f.use(a),f.use(t(process.env.PRIVATE_KEY)),f.use(n.json()),f.use(n.urlencoded({extended:!0})),f.use(i()),c(f),p(f),d(f),e.exports=f},function(e,r){e.exports=require("aws-serverless-express")},function(e,r,s){"use strict";const o=s(20),n=s(19);o.createServer(n);r.handler=((e,r,s)=>{s(null,{statusCode:200,body:JSON.stringify({hey:!0})})})}]));
//# sourceMappingURL=server.js.map